(window.webpackJsonp=window.webpackJsonp||[]).push([[529],{835:function(t,e,n){"use strict";n.r(e);var s=n(1),a=Object(s.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[n("p",[t._v("openHAB 2.4 brings a few noticeable features, one of them is a new way of integrating your MQTT devices. What is MQTT actually? And how does the new implementation differ from what was already available?")]),t._v(" "),n("p",[t._v("If you haven't heard about MQTT yet, it is probably time to have a "),n("a",{attrs:{href:"https://en.wikipedia.org/wiki/MQTT",target:"_blank",rel:"noopener noreferrer"}},[t._v("look"),n("OutboundLink")],1),t._v(". Quoting Wikipedia:")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),n("p",[t._v("In recent years MQTT got a lot of attention for the Internet of Things,\nMaker and DIY culture as well as home automation purposes.\nMainly because of its simplicity and its many client and server implementations.")]),t._v(" "),t._m(2),t._v(" "),n("p",[t._v("Let us wrap up a bit of history to understand what has changed.\nopenHAB had quite powerful MQTT support for its time in the 1.x days.")]),t._v(" "),t._m(3),t._v(" "),t._m(4),n("p",[t._v("What you see above is an item, bound to an MQTT topic as the source for the item state.")]),t._v(" "),n("p",[t._v("A command topic is defined for the switch item, used when the switch is turned.\nWhat happens on the MQTT level for the command topic is:")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),n("p",[t._v("The MQTT binding considered that from the beginning and offered to apply a transformation for received (and published) messages.")]),t._v(" "),n("p",[t._v("If your water meter for example sends JSon encoded data:")]),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),n("p",[t._v("Unfortunately the MQTT support did not evolve much while openHAB migrated to a new architecture for 2.x.")]),t._v(" "),t._m(10),t._v(" "),n("p",[t._v("Up until now, where some fundamental changes found their way into the codebase.")]),t._v(" "),t._m(11),t._v(" "),n("p",[t._v("The new MQTT architecture has been realized in an easy extensible, modular way.\nThe different bundles are fully test covered to live up to the high coding standards of openHAB.")]),t._v(" "),n("p",[t._v("I will now take you on a journey of exploring all the new features, arriving soon on your openHAB installation.")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),n("p",[t._v("The new MQTT binding can coexist with the old MQTT openHAB 1.x binding (but I really do not recommend this setup).")]),t._v(" "),t._m(14),t._v(" "),n("p",[t._v("When it comes to MQTT enabled devices, like your WiFi wall plug or custom Arduino or ESP8266 solution,\nyou first need to take care of a very central aspect, the MQTT broker.")]),t._v(" "),n("p",[t._v("Configuring the MQTT broker connection is so essential for a good MQTT support,\nthat you can now finally do this in a graphical fashion.")]),t._v(" "),n("p",[t._v("Select the correct Thing to create:")]),t._v(" "),t._m(15),t._v(" "),n("p",[t._v("Configure your Broker connection:")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),n("p",[t._v("A broker connection can fail for many reasons.\nMay it be wrong credentials, a denied tcp connection (i.e. firewall), a maximum connection limit\nor just the wrong IP and Port configuration parameters.")]),t._v(" "),n("p",[t._v("The former MQTT implementation knew about the reason as well,\nbut at that time could only log any problem.\nThe reason is now directly presented to you via the Thing status.")]),t._v(" "),n("p",[t._v("This also means, the status is available for the automation rule engine to e.g.\nreact on a failing broker connection.")]),t._v(" "),t._m(18),t._v(" "),n("p",[t._v("To wrap it up: MQTT can be enabled for your network by")]),t._v(" "),t._m(19),t._v(" "),n("p",[t._v("Right?")]),t._v(" "),n("p",[t._v("Actually, it is even simpler. openHAB comes with an embedded MQTT broker now:")]),t._v(" "),t._m(20),t._v(" "),n("p",[t._v("All you have to do is, installing the addon in Paper UI to have a working MQTT broker, ready to use.")]),t._v(" "),n("p",[t._v("You can optionally configure the embedded broker in the service section of PaperUI (or via text files as usual):")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),n("p",[t._v('The MQTT standard does not enforce any topic layout or topic value format.\nA smart light vendor can decide to publish his lights under a "vendorname/deviceID/light" MQTT topic\nor use a totally different layout like "light/vendorname/deviceid".')]),t._v(" "),t._m(24),t._v(" "),n("p",[t._v("That is why MQTT topic and format conventions got established amongst the DIY IoT community.\nThe new MQTT Things extension supports two conventions out-of-the-box:")]),t._v(" "),n("ul",[n("li",[t._v("The "),n("a",{attrs:{href:"https://homieiot.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Homie 3.x specification"),n("OutboundLink")],1),t._v(": This vender neutral MQTT convention defines the layout of MQTT topics and the value format. It allows a full device capabilities discovery.")]),t._v(" "),n("li",[t._v("The "),n("a",{attrs:{href:"https://www.home-assistant.io/docs/mqtt/discovery/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HomeAssistant MQTT Components specification"),n("OutboundLink")],1),t._v(": Some common components like a Light, a Switch, a Fan, an Air-Conditioner and so on are defined. More generic device capabilities cannot be expressed via this convention.")])]),t._v(" "),n("p",[t._v("Because the topic structure of a convention is known,\nthe MQTT Things extension is able to provide auto-discovery and mapping of MQTT topics to openHAB Things and Channels.")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),n("p",[t._v("The process is quite easy and can be done on Paper UI, or via textual configuration.\nFor the later see the section towards the end of this blog post.")]),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),n("p",[t._v("Add a channel with a matching type to your Thing:")]),t._v(" "),t._m(34),t._v(" "),n("p",[t._v("The following channel types are supported:")]),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),n("p",[t._v('There is an openHAB 1.x addon, called "MQTT Action". It allows to send arbitrary payloads\nto arbitrary topics from rule and script files.')]),t._v(" "),n("p",[t._v("There is an equivalent functionality also available for the new MQTT binding. It is build up\non the new automation engine and works from textual DSL rule files as well as from new\nscript (JavaScript/Jython) and new automation rules. An example is given below:")]),t._v(" "),t._m(40),n("p",[t._v("Unfortunately Paper UI is not yet capable of graphically create useful rules with this action.\nThis is a limitation of Paper UI and will be resolved in future releases.")]),t._v(" "),t._m(41),t._v(" "),n("p",[t._v("You find all examples in this blog post performed via Paper UI.\nYou can of course still setup every aspect via text files,\nlike in the following examples.")]),t._v(" "),t._m(42),t._v(" "),t._m(43),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._m(47),t._v(" "),t._m(48),t._v(" "),n("p",[t._v("For openHAB distributors it is crucial to pre-configure openHAB\nto offer a seamless integration of pre-installed extensions and\n3rd-party software like an MQTT broker.")]),t._v(" "),n("p",[t._v("As in the version before, you can tell openHAB about MQTT brokers\nvia the mqtt service configuration file.")]),t._v(" "),n("p",[t._v('Instead of populating an "mqtt.conf" file though,\nyou are now creating an "etc/whatever-name.cfg" file that contains the following lines:')]),t._v(" "),t._m(49),n("p",[t._v("Those pre-defined connections are called system broker connections.\nBe aware that this adds the broker to the Inbox, but does not create a Broker Thing on its own.")]),t._v(" "),t._m(50),t._v(" "),n("p",[t._v("The discussed MQTT bindings allow an easy point and click configuration to incorporate your\nMQTT capable devices into openHAB. If your device follows any supported MQTT convention,\nit got even simpler with full auto-discovery of all device capabilities. At the same\ntime all advanced requirements that the community brought up during development,\ncould be considered.")]),t._v(" "),n("p",[t._v("This is a contribution by an external author, and I feel the need to talk a few seconds about my motivation.")]),t._v(" "),n("p",[t._v("I think, that a home-automation framework should be simple to configure.\nI'm talking about a graphical interface to install, enable and disable plugins,\nto setup plugins in a graphical fashion and to control provided functionality\nright after everything was configured.")]),t._v(" "),n("p",[t._v("That is why I got caught by the openHAB 2 development, where Paper UI got introduced.\nThe "),n("a",{attrs:{href:"https://community.openhab.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("community"),n("OutboundLink")],1),t._v(" was amazing, super friendly and welcoming\nwhen I asked my first questions on the forum.")]),t._v(" "),n("p",[t._v("The many issues appearing weekly, over and over, with the openHAB 1.x MQTT binding\ngot me thinking. It was just time that MQTT support arrives in a openHAB 2 compatible fashion.")]),t._v(" "),n("p",[t._v("I am really happy how this support turned out and I hope you will find it as useful as I do and\nthat MQTT feels like a first class citizen now.")]),t._v(" "),n("p",[t._v("If you have any comments on how we as a community can improve the support or covering even more use-cases,\nhead over to the "),n("a",{attrs:{href:"https://community.openhab.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("discussion forum"),n("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(51)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v('"MQTT (Message Queuing Telemetry Transport) is an ISO standard (ISO/IEC PRF 20922)[2] publish-subscribe-based messaging protocol. […] It is designed for connections with remote locations where a "small code footprint" is required or the network bandwidth is limited.  […]')]),this._v(" "),e("p",[this._v('An MQTT system consists of clients communicating with a server, often called a "broker". A client may be either a publisher of information or a subscriber. Each client can connect to the broker.')]),this._v(" "),e("p",[this._v('Information is organized in a hierarchy of topics."')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_esh_mqtt-MQTT-Overview.png",title:"MQTT Overview with Broker and clients"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"mqtt-in-openhab-1-x-and-up-to-2-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-in-openhab-1-x-and-up-to-2-3","aria-hidden":"true"}},[this._v("#")]),this._v(" MQTT in openHAB 1.x and up to 2.3")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("First you would have defined one or multiple MQTT brokers in a service configuration file.\nIn a next step some lines like the following would have been added to your "),e("em",[this._v(".item")]),this._v(" file:")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dsl"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("mySwitch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("mqtt"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<[mybroker:home/office/lamp:state:default],>[mybroker:home/office/lamp/set:command:*]"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ol",[n("li",[t._v("The target device "),n("b",[t._v("subscribes")]),t._v(" to the command topic "),n("code",[t._v("home/office/lamp/set")]),t._v(":\n"),n("p",{attrs:{align:"center"}},[n("img",{attrs:{src:"/uploads/2018-12_esh_mqtt-mqttpublishsubscribe1.png",alt:"MQTT Command Topic Subscribe"}})])]),n("li",[t._v("openHAB "),n("b",[t._v("publishes")]),t._v(" via the MQTT connection to the command topic "),n("code",[t._v("home/office/lamp/set")]),t._v(":\n"),n("p",{attrs:{align:"center"}},[n("img",{attrs:{src:"/uploads/2018-12_esh_mqtt-mqttpublishsubscribe2.png",alt:"MQTT Command Topic Publish"}})])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("MQTT doesn't restrict you on what to publish as topic values and it is not part of the standard how to express a boolean or enumeration value.\nSome vendors use xml, some use json structured data and some just send plain strings like "),e("em",[this._v("1")]),this._v(" or "),e("em",[this._v("ON")]),this._v(".")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   device"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      meters"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Have a look at this corresponding "),e("code",[this._v("Number")]),this._v(" item, where a JSONPATH is used to extract the value of interest:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v('Number waterConsumption "consum [%d]" {mqtt="<[mybroker:myHome/watermeter:state:$.device.meters[0].value]"}')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("It is not possible to use Paper UI at all to define MQTT brokers.")]),this._v(" "),e("li",[this._v("You can not graphically define MQTT linked Things and Channels.")]),this._v(" "),e("li",[this._v("And your feedback for a configuration problem narrows down to skimming through log files.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"mqtt-in-openhab-2-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-in-openhab-2-4","aria-hidden":"true"}},[this._v("#")]),this._v(" MQTT in openHAB 2.4")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("First of all, you want to install the new MQTT binding, for example from within Paper UI in the "),e("em",[this._v("Addons")]),this._v(" section:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_esh_things_install.png",alt:"MQTT Binding install"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"mqtt-broker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-broker","aria-hidden":"true"}},[this._v("#")]),this._v(" MQTT Broker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_mqtt-broker-create1.png",alt:"MQTT Create Thing"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_mqtt-broker-create2.png",alt:"Configure your Broker connection"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"broker-connection-status"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#broker-connection-status","aria-hidden":"true"}},[this._v("#")]),this._v(" Broker Connection Status")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"embedded-mqtt-broker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#embedded-mqtt-broker","aria-hidden":"true"}},[this._v("#")]),this._v(" Embedded MQTT Broker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("installing an MQTT broker,")]),this._v(" "),e("li",[this._v("configuring an MQTT broker,")]),this._v(" "),e("li",[this._v("Adding the Broker Thing and configuring it in Paper UI.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_esh_embedded_install.png",alt:"Install embedded MQTT Broker"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_esh_embedded_configure.png",alt:"Configure embedded MQTT Broker"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("A new "),e("em",[this._v("Broker Connection")]),this._v(" appears in your Inbox.\nJust add it, no further configuration necessary.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"mqtt-thing-auto-discovery"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-thing-auto-discovery","aria-hidden":"true"}},[this._v("#")]),this._v(" MQTT Thing Auto-Discovery")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("People even disagree about the value format, sometimes it is "),e("em",[this._v("ON")]),this._v(", sometimes "),e("em",[this._v("1")]),this._v(" or "),e("em",[this._v("true")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_mqtt-homie-temperature.png",alt:"Homie discovered Topics"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("If you setup your next DIY Home-Automation gadget, consider flashing it with a "),e("em",[this._v("Homie 3.x")]),this._v(" compatible firmware and it will work with openHAB right away.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"mqtt-generic-things"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-generic-things","aria-hidden":"true"}},[this._v("#")]),this._v(" MQTT Generic Things")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("It cannot be stressed enough, to consider changing existing MQTT client devices to an MQTT convention like the mentioned "),e("em",[this._v("Homie 3.x")]),this._v(" convention.\nThat might not be possible in some cases though.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Use one or multiple "),e("em",[this._v("Generic MQTT Things")]),this._v(" to group an arbitrary number of channels each:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_generic_mqtt_thing_with_channels.png",alt:"Generic MQTT Thing with channels"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_generic_mqtt_thing_create_1.png",alt:"Add Generic MQTT Thing"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The created Thing appears "),e("em",[this._v("Online")]),this._v(" if the broker connection is "),e("em",[this._v("Online")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_generic_mqtt_thing_create_2.png",alt:"Generic MQTT Thing"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_add_channel_1.png",alt:"Add channel to Generic Thing"}})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",[n("thead",[n("tr",[n("th",[t._v("Type")]),t._v(" "),n("th",[t._v("Parameters")]),t._v(" "),n("th",[t._v("Description")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("String")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("Shows the received text on the given topic and send text to a given topic.")])]),t._v(" "),n("tr",[n("td",[t._v("Number")]),t._v(" "),n("td",[t._v("min, max")]),t._v(" "),n("td",[t._v("Shows the received number on the given topic and send a number to a given topic.")])]),t._v(" "),n("tr",[n("td",[t._v("Percentage")]),t._v(" "),n("td",[t._v("min, max, step")]),t._v(" "),n("td",[t._v("Handles numeric values as percentages for Dimmer or Rollershutter items for example.")])]),t._v(" "),n("tr",[n("td",[t._v("Contact")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("This channel represents a open/close state of a given topic.")])]),t._v(" "),n("tr",[n("td",[t._v("Switch")]),t._v(" "),n("td",[t._v("custom on/off")]),t._v(" "),n("td",[t._v("Represents an on/off state of a given topic and can send an on/off value to a given topic.")])]),t._v(" "),n("tr",[n("td",[t._v("Color RGB/HSB")]),t._v(" "),n("td",[t._v("custom on/off")]),t._v(" "),n("td",[t._v("Handles color values in RGB / HSB format.")])]),t._v(" "),n("tr",[n("td",[t._v("DateTime")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("This channel handles date/time values.")])]),t._v(" "),n("tr",[n("td",[t._v("Image")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("This channel handles binary images in common java supported formats (bmp,jpg,png).")])]),t._v(" "),n("tr",[n("td",[t._v("Location")]),t._v(" "),n("td"),t._v(" "),n("td",[t._v("This channel handles a location.")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Each "),e("em",[this._v("Channel")]),this._v(" requires configuration and is bound to an MQTT topic for the channel state\nand another MQTT topic for the command:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",{attrs:{align:"center"}},[e("img",{attrs:{src:"/uploads/2018-12_mqtt-generic-channel-config.png",alt:"Generic MQTT Thing channel configuration"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Each channel supports a transformation pattern to extract a state from a structured response like JSON.\nAn example would be the pattern "),e("code",[this._v("JSONPATH:$.device.status.temperature")]),this._v(" for an\nincoming MQTT message of "),e("code",[this._v("{device: {status: { temperature: 23.2 }}}")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"mqtt-actions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-actions","aria-hidden":"true"}},[this._v("#")]),this._v(" MQTT Actions")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-rules"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rule")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"On system start"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("when")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("System started")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" actions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getActions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mqtt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mqtt:systemBroker:embedded-mqtt-broker"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  actions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("publishMQTT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test/system/started"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"configuration-via-text-files"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration-via-text-files","aria-hidden":"true"}},[this._v("#")]),this._v(" Configuration via Text Files")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("broker.things")]),this._v(" file:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('mqtt:broker:mySecureBroker [ host="192.168.0.41", secure=true, certificatepin=true, publickeypin=true ]\nmqtt:broker:myUnsecureBroker [ host="192.168.0.42", secure=false ]\n\nmqtt:broker:myAuthentificatedBroker [ host="192.168.0.43",secure=true, username="user", password="password" ]\n\nmqtt:broker:pinToPublicKey [ host="192.168.0.44", secure=true , publickeypin=true, publickey="SHA-256:9a6f30e67ae9723579da2575c35daf7da3b370b04ac0bde031f5e1f5e4617eb8" ]\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("In a first example a very secure connection to a broker is defined. It pins the returned certificate and public key. If someone tries a man in the middle attack later on, this broker connection will recognize it and refuse a connection. Be aware that if your brokers certificate changes, you need to remove the connection entry and add it again.")]),this._v(" "),e("li",[this._v("The second connection is a plain, unsecured one. Use this only for local MQTT Brokers.")]),this._v(" "),e("li",[this._v("A third connection uses a username and password for authentication. The credentials are plain values on the wire, therefore you should only use this on a secure connection.")]),this._v(" "),e("li",[this._v('In a forth connection, the public key pinning is enabled again. This time, a public key hash is provided to pin the connection to a specific server. It follows the form "hashname:hashvalue". Valid hashnames are SHA-1, SHA-224, SHA-256, SHA-384, SHA-512 and all others listed in Java MessageDigest Algorithms.')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("em",[this._v("mqtt.things")]),this._v(" file:")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dsl"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Bridge")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("mqtt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("broker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("myUnsecureBroker")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.42"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secure"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Thing")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("mqtt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("mything")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Channels")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Type")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" lamp "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Kitchen Lamp"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" stateTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lamp/enabled"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commandTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lamp/enabled/set"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Type")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fancylamp "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Fancy Lamp"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" stateTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fancy/lamp/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commandTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fancy/lamp/command"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" on"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"i-am-on"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" off"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"i-am-off"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Type")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" alarmpanel "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Alarm system"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" stateTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alarm/panel/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commandTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alarm/panel/set"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" allowedStates"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ARMED_HOME,ARMED_AWAY,UNARMED"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Type")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("color")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" lampcolor "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Kitchen Lamp color"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" stateTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lamp/color"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commandTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lamp/color/set"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rgb"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Type")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("dimmer")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" blind "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Blind"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" stateTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blind/state"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" commandTopic"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blind/set"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" min"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("step")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("In the given example an unsecure broker connection is defined with a "),e("em",[this._v("Generic MQTT Thing")]),this._v(" that has 5 channels added.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"system-broker-connections"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#system-broker-connections","aria-hidden":"true"}},[this._v("#")]),this._v(" System Broker Connections")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('service.pid="org.eclipse.smarthome.mqttbroker"\nname="mosquitto"\nusername="username"\npassword="password"\nclientID="localClient123"\nhost="127.0.0.1"\nsecure=false\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"conclusion"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#conclusion","aria-hidden":"true"}},[this._v("#")]),this._v(" Conclusion")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Cheers,"),e("br"),this._v("\nDavid Graeff")])}],!1,null,null,null);e.default=a.exports}}]);