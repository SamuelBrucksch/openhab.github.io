<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MQTT Arrives in the Modern openHAB 2.x Architecture | openHAB</title>
    <meta name="description" content="openHAB - a vendor and technology agnostic open source automation software for your home">
    <link rel="stylesheet" href="/fonts/fonts.css">
  <link rel="icon" href="/favicon.ico">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-icon.png">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://www.openhab.org/og-image.png">
    <meta name="twitter:card" content="summary_large_image"><meta property="og:title" content="MQTT Arrives in the Modern openHAB 2.x Architecture"><meta property="og:description" content="The new MQTT bindings allow an easy point and click configuration to include your MQTT capable device into openHAB. If your device follows any supported MQTT convention, it got even simpler with full auto-discovery of all device capabilities."><meta property="og:image" content="https://www.openhab.org/uploads/mqttblog.jpg">
    <link rel="preload" href="/assets/css/0.styles.a2bd854d.css" as="style"><link rel="preload" href="/assets/js/app.b1a3353e.js" as="script"><link rel="preload" href="/assets/js/25.548cd09b.js" as="script"><link rel="preload" href="/assets/js/529.3b31a78e.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.a2bd854d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/openhab-logo.png" alt="openHAB" class="logo"> <span class="site-name can-hide">openHAB</span></a> <div class="links" style="max-width:nullpx;"><form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/download/" class="nav-link">Download</a></div><div class="nav-item"><a href="/docs/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/addons/" class="nav-link">Add-ons</a></div><div class="nav-item"><a href="/community/" class="nav-link">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Get Involved</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/who-we-are.html" class="nav-link">Who We Are</a></li><li class="dropdown-subitem"><a href="/about/contributing.html" class="nav-link">Contribute</a></li><li class="dropdown-subitem"><a href="/about/events.html" class="nav-link">Events</a></li></ul></li><li class="dropdown-item"><h4>Support openHAB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://openhabfoundation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Foundation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/about/donate.html" class="nav-link">Donate</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/showcase.html" class="nav-link">Showcase/How-tos</a></li><li class="dropdown-subitem"><a href="/privacy.html" class="nav-link">Privacy Policy</a></li><li class="dropdown-subitem"><a href="https://www.myopenhab.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  myopenHAB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/openhab" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/download/" class="nav-link">Download</a></div><div class="nav-item"><a href="/docs/" class="nav-link">Documentation</a></div><div class="nav-item"><a href="/addons/" class="nav-link">Add-ons</a></div><div class="nav-item"><a href="/community/" class="nav-link">Community</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">About</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Get Involved</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/who-we-are.html" class="nav-link">Who We Are</a></li><li class="dropdown-subitem"><a href="/about/contributing.html" class="nav-link">Contribute</a></li><li class="dropdown-subitem"><a href="/about/events.html" class="nav-link">Events</a></li></ul></li><li class="dropdown-item"><h4>Support openHAB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://openhabfoundation.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Foundation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="/about/donate.html" class="nav-link">Donate</a></li></ul></li><li class="dropdown-item"><h4>Resources</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/showcase.html" class="nav-link">Showcase/How-tos</a></li><li class="dropdown-subitem"><a href="/privacy.html" class="nav-link">Privacy Policy</a></li><li class="dropdown-subitem"><a href="https://www.myopenhab.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  myopenHAB
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/openhab" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <div class="custom-layout"><div><div class="post-header" style="background:url(/uploads/mqttblog.jpg) no-repeat center;"><div class="post-cover"><h1 class="post-title">
        MQTT Arrives in the Modern openHAB 2.x Architecture
      </h1></div></div> <div class="blog-body-content"><div class="page-author"><strong>David Graeff</strong> posted on <span style="white-space: nowrap">Sunday, December 16, 2018</span></div> <div class="content"><div class="content custom"><p>openHAB 2.4 brings a few noticeable features, one of them is a new way of integrating your MQTT devices. What is MQTT actually? And how does the new implementation differ from what was already available?</p> <p>If you haven't heard about MQTT yet, it is probably time to have a <a href="https://en.wikipedia.org/wiki/MQTT" target="_blank" rel="noopener noreferrer">look<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Quoting Wikipedia:</p> <blockquote><p>&quot;MQTT (Message Queuing Telemetry Transport) is an ISO standard (ISO/IEC PRF 20922)[2] publish-subscribe-based messaging protocol. […] It is designed for connections with remote locations where a &quot;small code footprint&quot; is required or the network bandwidth is limited.  […]</p> <p>An MQTT system consists of clients communicating with a server, often called a &quot;broker&quot;. A client may be either a publisher of information or a subscriber. Each client can connect to the broker.</p> <p>Information is organized in a hierarchy of topics.&quot;</p></blockquote> <p align="center"><img src="/uploads/2018-12_esh_mqtt-MQTT-Overview.png" title="MQTT Overview with Broker and clients"></p> <p>In recent years MQTT got a lot of attention for the Internet of Things,
Maker and DIY culture as well as home automation purposes.
Mainly because of its simplicity and its many client and server implementations.</p> <h2 id="mqtt-in-openhab-1-x-and-up-to-2-3"><a href="#mqtt-in-openhab-1-x-and-up-to-2-3" aria-hidden="true" class="header-anchor">#</a> MQTT in openHAB 1.x and up to 2.3</h2> <p>Let us wrap up a bit of history to understand what has changed.
openHAB had quite powerful MQTT support for its time in the 1.x days.</p> <p>First you would have defined one or multiple MQTT brokers in a service configuration file.
In a next step some lines like the following would have been added to your <em>.item</em> file:</p> <div class="language- extra-class"><pre class="language-dsl"><code><span class="token keyword">Switch</span> <span class="token class-name">mySwitch</span> <span class="token punctuation">{</span>mqtt<span class="token operator">=</span><span class="token string">&quot;&lt;[mybroker:home/office/lamp:state:default],&gt;[mybroker:home/office/lamp/set:command:*]&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p>What you see above is an item, bound to an MQTT topic as the source for the item state.</p> <p>A command topic is defined for the switch item, used when the switch is turned.
What happens on the MQTT level for the command topic is:</p> <ol><li>The target device <b>subscribes</b> to the command topic <code>home/office/lamp/set</code>:
<p align="center"><img src="/uploads/2018-12_esh_mqtt-mqttpublishsubscribe1.png" alt="MQTT Command Topic Subscribe"></p></li><li>openHAB <b>publishes</b> via the MQTT connection to the command topic <code>home/office/lamp/set</code>:
<p align="center"><img src="/uploads/2018-12_esh_mqtt-mqttpublishsubscribe2.png" alt="MQTT Command Topic Publish"></p></li></ol> <p>MQTT doesn't restrict you on what to publish as topic values and it is not part of the standard how to express a boolean or enumeration value.
Some vendors use xml, some use json structured data and some just send plain strings like <em>1</em> or <em>ON</em>.</p> <p>The MQTT binding considered that from the beginning and offered to apply a transformation for received (and published) messages.</p> <p>If your water meter for example sends JSon encoded data:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   device<span class="token operator">:</span> <span class="token punctuation">{</span>
      meters<span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Have a look at this corresponding <code>Number</code> item, where a JSONPATH is used to extract the value of interest:</p> <p><code>Number waterConsumption &quot;consum [%d]&quot; {mqtt=&quot;&lt;[mybroker:myHome/watermeter:state:$.device.meters[0].value]&quot;}</code></p> <p>Unfortunately the MQTT support did not evolve much while openHAB migrated to a new architecture for 2.x.</p> <ul><li>It is not possible to use Paper UI at all to define MQTT brokers.</li> <li>You can not graphically define MQTT linked Things and Channels.</li> <li>And your feedback for a configuration problem narrows down to skimming through log files.</li></ul> <p>Up until now, where some fundamental changes found their way into the codebase.</p> <h2 id="mqtt-in-openhab-2-4"><a href="#mqtt-in-openhab-2-4" aria-hidden="true" class="header-anchor">#</a> MQTT in openHAB 2.4</h2> <p>The new MQTT architecture has been realized in an easy extensible, modular way.
The different bundles are fully test covered to live up to the high coding standards of openHAB.</p> <p>I will now take you on a journey of exploring all the new features, arriving soon on your openHAB installation.</p> <p>First of all, you want to install the new MQTT binding, for example from within Paper UI in the <em>Addons</em> section:</p> <p align="center"><img src="/uploads/2018-12_esh_things_install.png" alt="MQTT Binding install"></p> <p>The new MQTT binding can coexist with the old MQTT openHAB 1.x binding (but I really do not recommend this setup).</p> <h3 id="mqtt-broker"><a href="#mqtt-broker" aria-hidden="true" class="header-anchor">#</a> MQTT Broker</h3> <p>When it comes to MQTT enabled devices, like your WiFi wall plug or custom Arduino or ESP8266 solution,
you first need to take care of a very central aspect, the MQTT broker.</p> <p>Configuring the MQTT broker connection is so essential for a good MQTT support,
that you can now finally do this in a graphical fashion.</p> <p>Select the correct Thing to create:</p> <p align="center"><img src="/uploads/2018-12_mqtt-broker-create1.png" alt="MQTT Create Thing"></p> <p>Configure your Broker connection:</p> <p align="center"><img src="/uploads/2018-12_mqtt-broker-create2.png" alt="Configure your Broker connection"></p> <h4 id="broker-connection-status"><a href="#broker-connection-status" aria-hidden="true" class="header-anchor">#</a> Broker Connection Status</h4> <p>A broker connection can fail for many reasons.
May it be wrong credentials, a denied tcp connection (i.e. firewall), a maximum connection limit
or just the wrong IP and Port configuration parameters.</p> <p>The former MQTT implementation knew about the reason as well,
but at that time could only log any problem.
The reason is now directly presented to you via the Thing status.</p> <p>This also means, the status is available for the automation rule engine to e.g.
react on a failing broker connection.</p> <h3 id="embedded-mqtt-broker"><a href="#embedded-mqtt-broker" aria-hidden="true" class="header-anchor">#</a> Embedded MQTT Broker</h3> <p>To wrap it up: MQTT can be enabled for your network by</p> <ol><li>installing an MQTT broker,</li> <li>configuring an MQTT broker,</li> <li>Adding the Broker Thing and configuring it in Paper UI.</li></ol> <p>Right?</p> <p>Actually, it is even simpler. openHAB comes with an embedded MQTT broker now:</p> <p align="center"><img src="/uploads/2018-12_esh_embedded_install.png" alt="Install embedded MQTT Broker"></p> <p>All you have to do is, installing the addon in Paper UI to have a working MQTT broker, ready to use.</p> <p>You can optionally configure the embedded broker in the service section of PaperUI (or via text files as usual):</p> <p align="center"><img src="/uploads/2018-12_esh_embedded_configure.png" alt="Configure embedded MQTT Broker"></p> <p>A new <em>Broker Connection</em> appears in your Inbox.
Just add it, no further configuration necessary.</p> <h3 id="mqtt-thing-auto-discovery"><a href="#mqtt-thing-auto-discovery" aria-hidden="true" class="header-anchor">#</a> MQTT Thing Auto-Discovery</h3> <p>The MQTT standard does not enforce any topic layout or topic value format.
A smart light vendor can decide to publish his lights under a &quot;vendorname/deviceID/light&quot; MQTT topic
or use a totally different layout like &quot;light/vendorname/deviceid&quot;.</p> <p>People even disagree about the value format, sometimes it is <em>ON</em>, sometimes <em>1</em> or <em>true</em>.</p> <p>That is why MQTT topic and format conventions got established amongst the DIY IoT community.
The new MQTT Things extension supports two conventions out-of-the-box:</p> <ul><li>The <a href="https://homieiot.github.io/" target="_blank" rel="noopener noreferrer">Homie 3.x specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: This vender neutral MQTT convention defines the layout of MQTT topics and the value format. It allows a full device capabilities discovery.</li> <li>The <a href="https://www.home-assistant.io/docs/mqtt/discovery/" target="_blank" rel="noopener noreferrer">HomeAssistant MQTT Components specification<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Some common components like a Light, a Switch, a Fan, an Air-Conditioner and so on are defined. More generic device capabilities cannot be expressed via this convention.</li></ul> <p>Because the topic structure of a convention is known,
the MQTT Things extension is able to provide auto-discovery and mapping of MQTT topics to openHAB Things and Channels.</p> <p align="center"><img src="/uploads/2018-12_mqtt-homie-temperature.png" alt="Homie discovered Topics"></p> <p>If you setup your next DIY Home-Automation gadget, consider flashing it with a <em>Homie 3.x</em> compatible firmware and it will work with openHAB right away.</p> <h3 id="mqtt-generic-things"><a href="#mqtt-generic-things" aria-hidden="true" class="header-anchor">#</a> MQTT Generic Things</h3> <p>It cannot be stressed enough, to consider changing existing MQTT client devices to an MQTT convention like the mentioned <em>Homie 3.x</em> convention.
That might not be possible in some cases though.</p> <p>Use one or multiple <em>Generic MQTT Things</em> to group an arbitrary number of channels each:</p> <p align="center"><img src="/uploads/2018-12_generic_mqtt_thing_with_channels.png" alt="Generic MQTT Thing with channels"></p> <p>The process is quite easy and can be done on Paper UI, or via textual configuration.
For the later see the section towards the end of this blog post.</p> <p align="center"><img src="/uploads/2018-12_generic_mqtt_thing_create_1.png" alt="Add Generic MQTT Thing"></p> <p>The created Thing appears <em>Online</em> if the broker connection is <em>Online</em>:</p> <p align="center"><img src="/uploads/2018-12_generic_mqtt_thing_create_2.png" alt="Generic MQTT Thing"></p> <p>Add a channel with a matching type to your Thing:</p> <p align="center"><img src="/uploads/2018-12_add_channel_1.png" alt="Add channel to Generic Thing"></p> <p>The following channel types are supported:</p> <table><thead><tr><th>Type</th> <th>Parameters</th> <th>Description</th></tr></thead> <tbody><tr><td>String</td> <td></td> <td>Shows the received text on the given topic and send text to a given topic.</td></tr> <tr><td>Number</td> <td>min, max</td> <td>Shows the received number on the given topic and send a number to a given topic.</td></tr> <tr><td>Percentage</td> <td>min, max, step</td> <td>Handles numeric values as percentages for Dimmer or Rollershutter items for example.</td></tr> <tr><td>Contact</td> <td></td> <td>This channel represents a open/close state of a given topic.</td></tr> <tr><td>Switch</td> <td>custom on/off</td> <td>Represents an on/off state of a given topic and can send an on/off value to a given topic.</td></tr> <tr><td>Color RGB/HSB</td> <td>custom on/off</td> <td>Handles color values in RGB / HSB format.</td></tr> <tr><td>DateTime</td> <td></td> <td>This channel handles date/time values.</td></tr> <tr><td>Image</td> <td></td> <td>This channel handles binary images in common java supported formats (bmp,jpg,png).</td></tr> <tr><td>Location</td> <td></td> <td>This channel handles a location.</td></tr></tbody></table> <p>Each <em>Channel</em> requires configuration and is bound to an MQTT topic for the channel state
and another MQTT topic for the command:</p> <p align="center"><img src="/uploads/2018-12_mqtt-generic-channel-config.png" alt="Generic MQTT Thing channel configuration"></p> <p>Each channel supports a transformation pattern to extract a state from a structured response like JSON.
An example would be the pattern <code>JSONPATH:$.device.status.temperature</code> for an
incoming MQTT message of <code>{device: {status: { temperature: 23.2 }}}</code>.</p> <h3 id="mqtt-actions"><a href="#mqtt-actions" aria-hidden="true" class="header-anchor">#</a> MQTT Actions</h3> <p>There is an openHAB 1.x addon, called &quot;MQTT Action&quot;. It allows to send arbitrary payloads
to arbitrary topics from rule and script files.</p> <p>There is an equivalent functionality also available for the new MQTT binding. It is build up
on the new automation engine and works from textual DSL rule files as well as from new
script (JavaScript/Jython) and new automation rules. An example is given below:</p> <div class="language- extra-class"><pre class="language-rules"><code><span class="token keyword">rule</span> <span class="token string">&quot;On system start&quot;</span>
<span class="token keyword">when</span>
  <span class="token keyword">System started</span>
<span class="token keyword">then</span>
  <span class="token keyword">val</span> actions <span class="token operator">=</span> <span class="token function">getActions</span><span class="token punctuation">(</span><span class="token string">&quot;mqtt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;mqtt:systemBroker:embedded-mqtt-broker&quot;</span><span class="token punctuation">)</span>
  actions<span class="token punctuation">.</span><span class="token function">publishMQTT</span><span class="token punctuation">(</span><span class="token string">&quot;test/system/started&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span>    
<span class="token keyword">end</span>
</code></pre></div><p>Unfortunately Paper UI is not yet capable of graphically create useful rules with this action.
This is a limitation of Paper UI and will be resolved in future releases.</p> <h3 id="configuration-via-text-files"><a href="#configuration-via-text-files" aria-hidden="true" class="header-anchor">#</a> Configuration via Text Files</h3> <p>You find all examples in this blog post performed via Paper UI.
You can of course still setup every aspect via text files,
like in the following examples.</p> <p><em>broker.things</em> file:</p> <div class="language- extra-class"><pre class="language-text"><code>mqtt:broker:mySecureBroker [ host=&quot;192.168.0.41&quot;, secure=true, certificatepin=true, publickeypin=true ]
mqtt:broker:myUnsecureBroker [ host=&quot;192.168.0.42&quot;, secure=false ]

mqtt:broker:myAuthentificatedBroker [ host=&quot;192.168.0.43&quot;,secure=true, username=&quot;user&quot;, password=&quot;password&quot; ]

mqtt:broker:pinToPublicKey [ host=&quot;192.168.0.44&quot;, secure=true , publickeypin=true, publickey=&quot;SHA-256:9a6f30e67ae9723579da2575c35daf7da3b370b04ac0bde031f5e1f5e4617eb8&quot; ]
</code></pre></div><ul><li>In a first example a very secure connection to a broker is defined. It pins the returned certificate and public key. If someone tries a man in the middle attack later on, this broker connection will recognize it and refuse a connection. Be aware that if your brokers certificate changes, you need to remove the connection entry and add it again.</li> <li>The second connection is a plain, unsecured one. Use this only for local MQTT Brokers.</li> <li>A third connection uses a username and password for authentication. The credentials are plain values on the wire, therefore you should only use this on a secure connection.</li> <li>In a forth connection, the public key pinning is enabled again. This time, a public key hash is provided to pin the connection to a specific server. It follows the form &quot;hashname:hashvalue&quot;. Valid hashnames are SHA-1, SHA-224, SHA-256, SHA-384, SHA-512 and all others listed in Java MessageDigest Algorithms.</li></ul> <p><em>mqtt.things</em> file:</p> <div class="language- extra-class"><pre class="language-dsl"><code><span class="token keyword">Bridge</span> <span class="token class-name">mqtt<span class="token punctuation">:</span>broker<span class="token punctuation">:</span>myUnsecureBroker</span> <span class="token punctuation">[</span> host<span class="token operator">=</span><span class="token string">&quot;192.168.0.42&quot;</span><span class="token punctuation">,</span> secure<span class="token operator">=</span><span class="token boolean">false</span> <span class="token punctuation">]</span>
<span class="token punctuation">{</span>
    <span class="token keyword">Thing</span> <span class="token class-name">mqtt<span class="token punctuation">:</span>topic<span class="token punctuation">:</span>mything</span> <span class="token punctuation">{</span>
    <span class="token keyword">Channels</span><span class="token operator">:</span>
        <span class="token keyword">Type</span> <span class="token class-name">switch</span> <span class="token operator">:</span> lamp <span class="token string">&quot;Kitchen Lamp&quot;</span> <span class="token punctuation">[</span> stateTopic<span class="token operator">=</span><span class="token string">&quot;lamp/enabled&quot;</span><span class="token punctuation">,</span> commandTopic<span class="token operator">=</span><span class="token string">&quot;lamp/enabled/set&quot;</span> <span class="token punctuation">]</span>
        <span class="token keyword">Type</span> <span class="token class-name">switch</span> <span class="token operator">:</span> fancylamp <span class="token string">&quot;Fancy Lamp&quot;</span> <span class="token punctuation">[</span> stateTopic<span class="token operator">=</span><span class="token string">&quot;fancy/lamp/state&quot;</span><span class="token punctuation">,</span> commandTopic<span class="token operator">=</span><span class="token string">&quot;fancy/lamp/command&quot;</span><span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">&quot;i-am-on&quot;</span><span class="token punctuation">,</span> off<span class="token operator">=</span><span class="token string">&quot;i-am-off&quot;</span> <span class="token punctuation">]</span>
        <span class="token keyword">Type</span> <span class="token class-name">string</span> <span class="token operator">:</span> alarmpanel <span class="token string">&quot;Alarm system&quot;</span> <span class="token punctuation">[</span> stateTopic<span class="token operator">=</span><span class="token string">&quot;alarm/panel/state&quot;</span><span class="token punctuation">,</span> commandTopic<span class="token operator">=</span><span class="token string">&quot;alarm/panel/set&quot;</span><span class="token punctuation">,</span> allowedStates<span class="token operator">=</span><span class="token string">&quot;ARMED_HOME,ARMED_AWAY,UNARMED&quot;</span> <span class="token punctuation">]</span>
        <span class="token keyword">Type</span> <span class="token class-name">color</span> <span class="token operator">:</span> lampcolor <span class="token string">&quot;Kitchen Lamp color&quot;</span> <span class="token punctuation">[</span> stateTopic<span class="token operator">=</span><span class="token string">&quot;lamp/color&quot;</span><span class="token punctuation">,</span> commandTopic<span class="token operator">=</span><span class="token string">&quot;lamp/color/set&quot;</span><span class="token punctuation">,</span> rgb<span class="token operator">=</span><span class="token boolean">true</span> <span class="token punctuation">]</span>
        <span class="token keyword">Type</span> <span class="token class-name">dimmer</span> <span class="token operator">:</span> blind <span class="token string">&quot;Blind&quot;</span> <span class="token punctuation">[</span> stateTopic<span class="token operator">=</span><span class="token string">&quot;blind/state&quot;</span><span class="token punctuation">,</span> commandTopic<span class="token operator">=</span><span class="token string">&quot;blind/set&quot;</span><span class="token punctuation">,</span> min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token constant">step</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the given example an unsecure broker connection is defined with a <em>Generic MQTT Thing</em> that has 5 channels added.</p> <h4 id="system-broker-connections"><a href="#system-broker-connections" aria-hidden="true" class="header-anchor">#</a> System Broker Connections</h4> <p>For openHAB distributors it is crucial to pre-configure openHAB
to offer a seamless integration of pre-installed extensions and
3rd-party software like an MQTT broker.</p> <p>As in the version before, you can tell openHAB about MQTT brokers
via the mqtt service configuration file.</p> <p>Instead of populating an &quot;mqtt.conf&quot; file though,
you are now creating an &quot;etc/whatever-name.cfg&quot; file that contains the following lines:</p> <div class="language- extra-class"><pre class="language-text"><code>service.pid=&quot;org.eclipse.smarthome.mqttbroker&quot;
name=&quot;mosquitto&quot;
username=&quot;username&quot;
password=&quot;password&quot;
clientID=&quot;localClient123&quot;
host=&quot;127.0.0.1&quot;
secure=false
</code></pre></div><p>Those pre-defined connections are called system broker connections.
Be aware that this adds the broker to the Inbox, but does not create a Broker Thing on its own.</p> <h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h2> <p>The discussed MQTT bindings allow an easy point and click configuration to incorporate your
MQTT capable devices into openHAB. If your device follows any supported MQTT convention,
it got even simpler with full auto-discovery of all device capabilities. At the same
time all advanced requirements that the community brought up during development,
could be considered.</p> <p>This is a contribution by an external author, and I feel the need to talk a few seconds about my motivation.</p> <p>I think, that a home-automation framework should be simple to configure.
I'm talking about a graphical interface to install, enable and disable plugins,
to setup plugins in a graphical fashion and to control provided functionality
right after everything was configured.</p> <p>That is why I got caught by the openHAB 2 development, where Paper UI got introduced.
The <a href="https://community.openhab.org/" target="_blank" rel="noopener noreferrer">community<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> was amazing, super friendly and welcoming
when I asked my first questions on the forum.</p> <p>The many issues appearing weekly, over and over, with the openHAB 1.x MQTT binding
got me thinking. It was just time that MQTT support arrives in a openHAB 2 compatible fashion.</p> <p>I am really happy how this support turned out and I hope you will find it as useful as I do and
that MQTT feels like a first class citizen now.</p> <p>If you have any comments on how we as a community can improve the support or covering even more use-cases,
head over to the <a href="https://community.openhab.org/" target="_blank" rel="noopener noreferrer">discussion forum<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Cheers,<br>
David Graeff</p></div></div></div> <footer><div class="social-icons"><a href="https://twitter.com/openhab" target="_blank"><svg class="social-icon twitter"><path d="M32 7.075c-1.175 0.525-2.444 0.875-3.769 1.031 1.356-0.813 2.394-2.1 2.887-3.631-1.269 0.75-2.675 1.3-4.169 1.594-1.2-1.275-2.906-2.069-4.794-2.069-3.625 0-6.563 2.938-6.563 6.563 0 0.512 0.056 1.012 0.169 1.494-5.456-0.275-10.294-2.888-13.531-6.862-0.563 0.969-0.887 2.1-0.887 3.3 0 2.275 1.156 4.287 2.919 5.463-1.075-0.031-2.087-0.331-2.975-0.819 0 0.025 0 0.056 0 0.081 0 3.181 2.263 5.838 5.269 6.437-0.55 0.15-1.131 0.231-1.731 0.231-0.425 0-0.831-0.044-1.237-0.119 0.838 2.606 3.263 4.506 6.131 4.563-2.25 1.762-5.075 2.813-8.156 2.813-0.531 0-1.050-0.031-1.569-0.094 2.913 1.869 6.362 2.95 10.069 2.95 12.075 0 18.681-10.006 18.681-18.681 0-0.287-0.006-0.569-0.019-0.85 1.281-0.919 2.394-2.075 3.275-3.394z"></path></svg></a> <a href="https://github.com/openhab" target="_blank"><svg class="social-icon github"><path d="M10.369 24.837c0 0.125-0.144 0.225-0.325 0.225-0.206 0.019-0.35-0.081-0.35-0.225 0-0.125 0.144-0.225 0.325-0.225 0.188-0.019 0.35 0.081 0.35 0.225zM8.425 24.556c-0.044 0.125 0.081 0.269 0.269 0.306 0.162 0.063 0.35 0 0.387-0.125s-0.081-0.269-0.269-0.325c-0.162-0.044-0.344 0.019-0.387 0.144zM11.188 24.45c-0.181 0.044-0.306 0.163-0.287 0.306 0.019 0.125 0.181 0.206 0.369 0.163 0.181-0.044 0.306-0.163 0.287-0.288-0.019-0.119-0.188-0.2-0.369-0.181zM15.3 0.5c-8.669 0-15.3 6.581-15.3 15.25 0 6.931 4.362 12.863 10.594 14.95 0.8 0.144 1.081-0.35 1.081-0.756 0-0.387-0.019-2.525-0.019-3.837 0 0-4.375 0.938-5.294-1.863 0 0-0.713-1.819-1.737-2.288 0 0-1.431-0.981 0.1-0.962 0 0 1.556 0.125 2.412 1.613 1.369 2.413 3.662 1.719 4.556 1.306 0.144-1 0.55-1.694 1-2.106-3.494-0.387-7.019-0.894-7.019-6.906 0-1.719 0.475-2.581 1.475-3.681-0.162-0.406-0.694-2.081 0.162-4.244 1.306-0.406 4.313 1.688 4.313 1.688 1.25-0.35 2.594-0.531 3.925-0.531s2.675 0.181 3.925 0.531c0 0 3.006-2.1 4.313-1.688 0.856 2.169 0.325 3.838 0.163 4.244 1 1.106 1.613 1.969 1.613 3.681 0 6.031-3.681 6.512-7.175 6.906 0.575 0.494 1.063 1.431 1.063 2.9 0 2.106-0.019 4.712-0.019 5.225 0 0.406 0.288 0.9 1.081 0.756 6.25-2.075 10.488-8.006 10.488-14.938 0-8.669-7.031-15.25-15.7-15.25zM6.075 22.056c-0.081 0.063-0.063 0.206 0.044 0.325 0.1 0.1 0.244 0.144 0.325 0.063 0.081-0.063 0.063-0.206-0.044-0.325-0.1-0.1-0.244-0.144-0.325-0.063zM5.4 21.55c-0.044 0.081 0.019 0.181 0.144 0.244 0.1 0.063 0.225 0.044 0.269-0.044 0.044-0.081-0.019-0.181-0.144-0.244-0.125-0.038-0.225-0.019-0.269 0.044zM7.425 23.775c-0.1 0.081-0.063 0.269 0.081 0.387 0.144 0.144 0.325 0.163 0.406 0.063 0.081-0.081 0.044-0.269-0.081-0.387-0.138-0.144-0.325-0.163-0.406-0.063zM6.713 22.856c-0.1 0.063-0.1 0.225 0 0.369s0.269 0.206 0.35 0.144c0.1-0.081 0.1-0.244 0-0.387-0.088-0.144-0.25-0.206-0.35-0.125z"></path></svg></a> <a href="https://www.youtube.com/channel/UC7OK88DW0La_BJlcXZg8ydQ" target="_blank"><svg class="social-icon youtube"><path d="M31.681 9.6c0 0-0.313-2.206-1.275-3.175-1.219-1.275-2.581-1.281-3.206-1.356-4.475-0.325-11.194-0.325-11.194-0.325h-0.012c0 0-6.719 0-11.194 0.325-0.625 0.075-1.987 0.081-3.206 1.356-0.963 0.969-1.269 3.175-1.269 3.175s-0.319 2.588-0.319 5.181v2.425c0 2.587 0.319 5.181 0.319 5.181s0.313 2.206 1.269 3.175c1.219 1.275 2.819 1.231 3.531 1.369 2.563 0.244 10.881 0.319 10.881 0.319s6.725-0.012 11.2-0.331c0.625-0.075 1.988-0.081 3.206-1.356 0.962-0.969 1.275-3.175 1.275-3.175s0.319-2.587 0.319-5.181v-2.425c-0.006-2.588-0.325-5.181-0.325-5.181zM12.694 20.15v-8.994l8.644 4.513-8.644 4.481z"></path></svg></a></div> <div class="legal"><span class="copyright">Copyright © 2019 by the openHAB Community and the openHAB Foundation e.V.</span> <br> <span class="legal-links"><a href="/privacy.html">Privacy policy</a> |
    <a href="/imprint.html">Imprint</a></span></div> <img src="/openhab-logo-square.png" class="footer-logo"></footer></div></div> <!----></div></div>
    <script src="/assets/js/app.b1a3353e.js" defer></script><script src="/assets/js/25.548cd09b.js" defer></script><script src="/assets/js/529.3b31a78e.js" defer></script>
  </body>
</html>
